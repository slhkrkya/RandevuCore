<!-- Settings Panel Content -->
<div class="space-y-4">
  <!-- Theme Settings -->
  <div>
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Tema</h3>
    <div class="flex space-x-2">
      <button 
        class="flex-1 px-3 py-2 text-[14px] rounded-md transition-colors"
        [class.bg-blue-500]="currentTheme() === 'light'"
        [class.text-white]="currentTheme() === 'light'"
        [class.bg-slate-200]="currentTheme() !== 'light'"
        [class.dark:bg-slate-700]="currentTheme() !== 'light'"
        [class.text-slate-700]="currentTheme() !== 'light'"
        [class.dark:text-slate-300]="currentTheme() !== 'light'"
        (click)="setTheme('light')">
        <span class="material-symbols-outlined text-sm mr-1">light_mode</span>
        Açık
      </button>
      <button 
        class="flex-1 px-3 py-2 text-[14px] rounded-md transition-colors"
        [class.bg-blue-500]="currentTheme() === 'dark'"
        [class.text-white]="currentTheme() === 'dark'"
        [class.bg-slate-200]="currentTheme() !== 'dark'"
        [class.dark:bg-slate-700]="currentTheme() !== 'dark'"
        [class.text-slate-700]="currentTheme() !== 'dark'"
        [class.dark:text-slate-300]="currentTheme() !== 'dark'"
        (click)="setTheme('dark')">
        <span class="material-symbols-outlined text-sm mr-1">dark_mode</span>
        Koyu
      </button>
      <button 
        class="flex-1 px-3 py-2 text-[14px] rounded-md transition-colors"
        [class.bg-blue-500]="currentTheme() === 'system'"
        [class.text-white]="currentTheme() === 'system'"
        [class.bg-slate-200]="currentTheme() !== 'system'"
        [class.dark:bg-slate-700]="currentTheme() !== 'system'"
        [class.text-slate-700]="currentTheme() !== 'system'"
        [class.dark:text-slate-300]="currentTheme() !== 'system'"
        (click)="setTheme('system')">
        <span class="material-symbols-outlined text-sm mr-1">computer</span>
        Sistem
      </button>
    </div>
  </div>

  <!-- Device Settings -->
  <div>
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Cihaz Ayarları</h3>
    
    <!-- Camera Selection -->
    <div class="mb-3">
      <label class="block text-[14px] text-slate-600 dark:text-slate-400 mb-1">Kamera</label>
      <div *ngIf="!hasCameraPermission()" class="mb-2">
        <div class="flex items-center p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md">
          <span class="material-symbols-outlined text-amber-600 dark:text-amber-400 text-sm mr-2">warning</span>
          <span class="text-[14px] text-amber-700 dark:text-amber-300">Kamera izni gerekli</span>
          <button 
            class="ml-auto px-2 py-1 text-[14px] bg-amber-600 hover:bg-amber-700 text-white rounded transition-colors"
            (click)="requestCameraPermission()">
            İzin Ver
          </button>
        </div>
      </div>
      <select 
        *ngIf="hasCameraPermission()"
        class="w-full px-3 py-2 text-[14px] bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [ngModel]="deviceSettings().cameraDeviceId || ''"
        (ngModelChange)="setCameraDevice($event || null)">
        <option value="">Varsayılan Kamera</option>
        <option *ngFor="let camera of availableCameras()" [value]="camera.deviceId">
          {{ getDeviceName(camera) }}
        </option>
      </select>
    </div>

    <!-- Microphone Selection -->
    <div class="mb-3">
      <label class="block text-[14px] text-slate-600 dark:text-slate-400 mb-1">Mikrofon</label>
      <div *ngIf="!hasMicrophonePermission()" class="mb-2">
        <div class="flex items-center p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md">
          <span class="material-symbols-outlined text-amber-600 dark:text-amber-400 text-sm mr-2">warning</span>
          <span class="text-[14px] text-amber-700 dark:text-amber-300">Mikrofon izni gerekli</span>
          <button 
            class="ml-auto px-2 py-1 text-[14px] bg-amber-600 hover:bg-amber-700 text-white rounded transition-colors"
            (click)="requestMicrophonePermission()">
            İzin Ver
          </button>
        </div>
      </div>
      <select 
        *ngIf="hasMicrophonePermission()"
        class="w-full px-3 py-2 text-[14px] bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [ngModel]="deviceSettings().microphoneDeviceId || ''"
        (ngModelChange)="setMicrophoneDevice($event || null)">
        <option value="">Varsayılan Mikrofon</option>
        <option *ngFor="let mic of availableMicrophones()" [value]="mic.deviceId">
          {{ getDeviceName(mic) }}
        </option>
      </select>
    </div>

    <!-- Speaker Selection -->
    <div class="mb-3">
      <label class="block text-[14px] text-slate-600 dark:text-slate-400 mb-1">Hoparlör</label>
      <select 
        class="w-full px-3 py-2 text-[14px] bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [ngModel]="deviceSettings().speakerDeviceId || ''"
        (ngModelChange)="setSpeakerDevice($event || null)">
        <option value="">Varsayılan Hoparlör</option>
        <option *ngFor="let speaker of availableSpeakers()" [value]="speaker.deviceId">
          {{ getDeviceName(speaker) }}
        </option>
      </select>
    </div>

    <!-- Microphone Volume -->
    <div *ngIf="hasMicrophonePermission()">
      <div class="volume-label">
        <span>Mikrofon Ses Seviyesi</span>
        <div class="flex items-center space-x-2">
          <span class="volume-percentage">{{ deviceSettings().microphoneVolume }}%</span>
          <button 
            class="btn btn-sm rounded-full p-1"
            [class.bg-red-500]="isAudioMuted()"
            [class.bg-green-500]="!isAudioMuted()"
            (click)="toggleAudioMute()"
            title="Mikrofonu Aç/Kapat">
            <span class="material-symbols-outlined text-white text-[14px]">
              {{ isAudioMuted() ? 'mic_off' : 'mic' }}
            </span>
          </button>
        </div>
      </div>
      <div class="slider-wrapper">
        <div class="level-overlay" [style.width.%]="currentAudioVolume()"></div>
        <input 
          type="range" 
          min="0" 
          max="100" 
          [ngModel]="deviceSettings().microphoneVolume"
          (ngModelChange)="setMicrophoneVolume($event)"
          class="w-full slider">
      </div>
      
      <!-- Audio Test Button (Press-and-hold) -->
      <div class="mt-2">
        <button 
          class="w-full px-3 py-2 text-[14px] rounded-md transition-colors"
          [class.bg-green-500]="isAudioListening()"
          [class.hover:bg-green-600]="isAudioListening()"
          [class.bg-blue-500]="!isAudioListening()"
          [class.hover:bg-blue-600]="!isAudioListening()"
          [class.text-white]="true"
          (pointerdown)="startAudioMonitoring()"
          (pointerup)="stopAudioMonitoring()"
          (pointerleave)="stopAudioMonitoring()"
          (contextmenu)="$event.preventDefault()"
        >
          <span class="material-symbols-outlined text-sm mr-1 align-middle">
            {{ isAudioListening() ? 'mic_off' : 'mic' }}
          </span>
          {{ isAudioListening() ? 'Basılı tutmayı bırakmak için bırakın' : 'Basılı tutarak Mikrofona Test Et' }}
        </button>
      </div>
    </div>

    <!-- Speaker Monitor Volume (App-wide) -->
    <div class="mt-4">
      <div class="volume-label">
        <span>Hoparlör Ses Seviyesi</span>
        <span class="volume-percentage">{{ speakerMonitorVolume() }}%</span>
      </div>
      <input
        type="range"
        min="0"
        max="100"
        [ngModel]="speakerMonitorVolume()"
        (ngModelChange)="setSpeakerMonitorVolume($event)"
        class="w-full slider">
      <div class="text-[12px] text-slate-500 dark:text-slate-400 mt-1">
        Bu ayar tüm uygulamada izleme sesini etkiler.
      </div>
    </div>
  </div>

  <!-- Video Background Settings -->
  <div class="mt-4" *ngIf="showVideoBackground">
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Video Arkaplanı</h3>

    <!-- Preview Toggle -->
    <div class="mb-3">
      <div class="flex items-center justify-between mb-2">
        <label class="text-[14px] text-slate-600 dark:text-slate-400">Kamera Önizlemesi</label>
        <button 
          class="px-3 py-1 text-[14px] rounded-md transition-colors"
          [class.bg-green-500]="isPreviewEnabled()"
          [class.hover:bg-green-600]="isPreviewEnabled()"
          [class.bg-slate-200]="!isPreviewEnabled()"
          [class.hover:bg-slate-300]="!isPreviewEnabled()"
          [class.dark:bg-slate-700]="!isPreviewEnabled()"
          [class.dark:hover:bg-slate-600]="!isPreviewEnabled()"
          [class.text-white]="isPreviewEnabled()"
          [class.text-slate-700]="!isPreviewEnabled()"
          [class.dark:text-slate-300]="!isPreviewEnabled()"
          (click)="toggleVideoPreview()"
          [disabled]="!hasCameraPermission()">
          <span class="material-symbols-outlined text-sm mr-1">
            {{ isPreviewEnabled() ? 'visibility' : 'visibility_off' }}
          </span>
          {{ isPreviewEnabled() ? 'Kapat' : 'Aç' }}
        </button>
      </div>
      
      <!-- Live Preview -->
      <div *ngIf="isPreviewEnabled()" class="relative w-full bg-slate-200 dark:bg-slate-800 rounded-md overflow-hidden" style="aspect-ratio: 16/9;">
        <video #videoPreview autoplay muted playsinline class="w-full h-full object-cover"></video>
      </div>
      
      <div class="text-[12px] text-slate-500 dark:text-slate-400 mt-1">
        {{ isPreviewEnabled() ? 'Önizleme sadece bu sayfada yerel olarak çalışır.' : 'Kamera önizlemesini açmak için yukarıdaki butona tıklayın.' }}
      </div>
    </div>

    <!-- Mode selection -->
    <div class="flex items-center space-x-2 mb-3">
      <label class="inline-flex items-center px-3 py-2 rounded-md cursor-pointer"
             [class.bg-blue-500]="videoBackground().mode === 'none'"
             [class.text-white]="videoBackground().mode === 'none'"
             [class.bg-slate-200]="videoBackground().mode !== 'none'"
             [class.dark:bg-slate-700]="videoBackground().mode !== 'none'">
        <input type="radio" class="hidden" name="vb-mode" [checked]="videoBackground().mode === 'none'" (change)="setVideoBackgroundMode('none')">
        <span class="text-[14px]">Kapalı</span>
      </label>

      <label class="inline-flex items-center px-3 py-2 rounded-md cursor-pointer"
             [class.bg-blue-500]="videoBackground().mode === 'blur'"
             [class.text-white]="videoBackground().mode === 'blur'"
             [class.bg-slate-200]="videoBackground().mode !== 'blur'"
             [class.dark:bg-slate-700]="videoBackground().mode !== 'blur'">
        <input type="radio" class="hidden" name="vb-mode" [checked]="videoBackground().mode === 'blur'" (change)="setVideoBackgroundMode('blur')">
        <span class="text-[14px]">Blur</span>
      </label>

      <label class="inline-flex items-center px-3 py-2 rounded-md cursor-pointer"
             [class.bg-blue-500]="videoBackground().mode === 'image'"
             [class.text-white]="videoBackground().mode === 'image'"
             [class.bg-slate-200]="videoBackground().mode !== 'image'"
             [class.dark:bg-slate-700]="videoBackground().mode !== 'image'">
        <input type="radio" class="hidden" name="vb-mode" [checked]="videoBackground().mode === 'image'" (change)="setVideoBackgroundMode('image')">
        <span class="text-[14px]">Resim</span>
      </label>
    </div>

    <!-- Blur level -->
    <div *ngIf="videoBackground().mode === 'blur'" class="mb-3">
      <label class="block text-[14px] text-slate-600 dark:text-slate-400 mb-1">Blur Seviyesi</label>
      <div class="flex items-center space-x-2">
        <button class="flex-1 px-3 py-2 text-[14px] rounded-md"
                [class.bg-blue-500]="videoBackground().blurLevel === 'none'"
                [class.text-white]="videoBackground().blurLevel === 'none'"
                [class.bg-slate-200]="videoBackground().blurLevel !== 'none'"
                [class.dark:bg-slate-700]="videoBackground().blurLevel !== 'none'"
                (click)="setVideoBackgroundBlurLevel('none')">
          Blursuz
        </button>
        <button class="flex-1 px-3 py-2 text-[14px] rounded-md"
                [class.bg-blue-500]="videoBackground().blurLevel === 'low'"
                [class.text-white]="videoBackground().blurLevel === 'low'"
                [class.bg-slate-200]="videoBackground().blurLevel !== 'low'"
                [class.dark:bg-slate-700]="videoBackground().blurLevel !== 'low'"
                (click)="setVideoBackgroundBlurLevel('low')">
          Az
        </button>
        <button class="flex-1 px-3 py-2 text-[14px] rounded-md"
                [class.bg-blue-500]="videoBackground().blurLevel === 'high'"
                [class.text-white]="videoBackground().blurLevel === 'high'"
                [class.bg-slate-200]="videoBackground().blurLevel !== 'high'"
                [class.dark:bg-slate-700]="videoBackground().blurLevel !== 'high'"
                (click)="setVideoBackgroundBlurLevel('high')">
          Çok
        </button>
      </div>
    </div>

    <!-- Image upload -->
    <div *ngIf="videoBackground().mode === 'image'" class="space-y-2">
      <label class="block text-[14px] text-slate-600 dark:text-slate-400">Arkaplan Resmi</label>
      <input type="file" accept="image/*" (change)="onBackgroundImageSelected($event)"
             class="w-full px-3 py-2 text-[14px] bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md" />
      <div *ngIf="videoBackground().imageDataUrl" class="flex items-center space-x-2">
        <img [src]="videoBackground().imageDataUrl!" alt="Önizleme" class="w-20 h-12 object-cover rounded border border-slate-300 dark:border-slate-600" />
        <button class="px-3 py-2 text-[14px] rounded-md bg-red-500 text-white" (click)="clearBackgroundImage()">Kaldır</button>
      </div>
      <div class="text-[12px] text-slate-500 dark:text-slate-400">Resim cihazınızda saklanır, sunucuya yüklenmez.</div>
    </div>

    <!-- Mirror toggle -->
    <div class="mt-3 flex items-center space-x-2">
      <input type="checkbox" id="mirrorPreview" class="h-4 w-4" [ngModel]="videoBackground().mirrorPreview" (ngModelChange)="setMirrorPreview($event)">
      <label for="mirrorPreview" class="text-[14px] text-slate-700 dark:text-slate-300">Önizlemeyi Aynala (Selfie)</label>
    </div>
  </div>
</div>
