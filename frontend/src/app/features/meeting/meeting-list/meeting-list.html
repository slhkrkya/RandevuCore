<div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 py-8 pt-20 relative overflow-hidden">
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-5">
    <div class="absolute top-1/4 left-0 w-96 h-96 bg-blue-500 rounded-full filter blur-3xl"></div>
    <div class="absolute bottom-1/4 right-0 w-80 h-80 bg-purple-500 rounded-full filter blur-3xl"></div>
  </div>
  
  <div class="container-xl relative z-10">
    <!-- Header -->
    <div class="mb-8 animate-fade-in">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
        <div class="text-center md:text-left">
          <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mb-4 md:mb-0 md:mr-4">
            <span class="material-symbols-outlined text-white text-2xl">video_call</span>
          </div>
          <div class="inline-block md:inline">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 dark:from-white dark:to-slate-300 bg-clip-text text-transparent">Toplantılarım</h1>
            <p class="mt-2 text-lg text-slate-600 dark:text-slate-400">
              Toplantılarınızı yönetin ve yeni toplantılar oluşturun
            </p>
          </div>
        </div>
        <button 
          routerLink="/meetings/new"
          class="btn btn-primary btn-lg animate-scale-in animate-delay-1"
        >
          <span class="material-symbols-outlined mr-2">add</span>
          Yeni Toplantı
        </button>
      </div>
    </div>

    <!-- Filter Section -->
    <div class="mb-6 animate-fade-in">
      <div class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 p-6">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
              <span class="material-symbols-outlined text-white text-lg">filter_list</span>
            </div>
            <div>
              <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-200">Toplantı Filtresi</h3>
              <p class="text-xs text-slate-500 dark:text-slate-400">Kişi bazında filtreleme yapın</p>
            </div>
          </div>
          <div class="flex items-center space-x-3">
            <div class="relative">
              <select 
                [(ngModel)]="selectedUserId" 
                (change)="onUserFilterChange(selectedUserId)"
                class="appearance-none bg-white/90 dark:bg-slate-700/90 border border-slate-300/50 dark:border-slate-600/50 rounded-xl px-4 py-3 pr-10 text-sm font-medium text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all duration-200 min-w-64 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="loadingUsers"
              >
                <option [value]="null" class="text-slate-700 dark:text-slate-200">
                  {{ loadingUsers ? 'Kullanıcılar yükleniyor...' : 'Tüm Toplantılar' }}
                </option>
                <option *ngFor="let user of users" [value]="user.id" class="text-slate-700 dark:text-slate-200">
                  {{ user.name }}
                </option>
              </select>
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <span class="material-symbols-outlined text-slate-400 dark:text-slate-500 text-lg">expand_more</span>
              </div>
            </div>
            <button 
              *ngIf="selectedUserId" 
              (click)="clearFilter()"
              class="inline-flex items-center justify-center w-10 h-10 bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white rounded-xl shadow-sm hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500/50"
              title="Filtreyi Temizle"
            >
              <span class="material-symbols-outlined text-sm">clear</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center py-20 animate-fade-in">
      <div class="text-center">
        <div class="spinner spinner-lg mx-auto mb-4"></div>
        <span class="text-slate-600 dark:text-slate-400 text-lg font-medium">Toplantılar yükleniyor...</span>
      </div>
    </div>

    <!-- Meetings Grid -->
    <div *ngIf="!loading && items?.length" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <div *ngFor="let meeting of items; let i = index" 
           class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 flex flex-col h-full animate-scale-in hover:shadow-2xl transition-all duration-300"
           [class.animate-delay-1]="i % 3 === 1"
           [class.animate-delay-2]="i % 3 === 2"
           [class.animate-delay-3]="i % 3 === 0">
        <!-- Card Header -->
        <div class="p-6 bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800 border-b border-slate-200 dark:border-slate-600">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center space-x-2 mb-2">
                <span class="material-symbols-outlined text-blue-500 text-lg">calendar_today</span>
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white">{{ meeting.title }}</h3>
              </div>
              <p class="text-sm text-slate-500 dark:text-slate-400">{{ meeting.startsAt | date:'dd MMMM yyyy, HH:mm':'tr-TR' }}</p>
            </div>
            <!-- Status Badge -->
            <div class="flex items-center space-x-2">
              <span class="badge"
                    [class.badge-success]="meeting.status === 'scheduled'"
                    [class.badge-warning]="meeting.status === 'done'"
                    [class.badge-error]="meeting.status === 'canceled'">
                {{ getStatusText(meeting.status) }}
              </span>
              
              <!-- Current Meeting Status -->
              <span *ngIf="isCurrentlyInThisMeeting(meeting.id)" 
                    class="badge badge-primary animate-pulse">
                <span class="material-symbols-outlined text-xs mr-1">videocam</span>
                {{ meetingStatus.currentMeeting()?.isBackground ? 'Arka planda' : 'Aktif' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Card Body -->
        <div class="p-6 flex-1">
          <div class="space-y-3">
            <!-- Time Range -->
            <div class="flex items-center text-sm text-slate-600 dark:text-slate-300">
              <span class="material-symbols-outlined text-base mr-2 text-blue-500">access_time</span>
              <span>{{ meeting.startsAt | date:'HH:mm':'tr-TR' }} - {{ meeting.endsAt | date:'HH:mm':'tr-TR' }}</span>
            </div>

            <!-- Notes -->
            <div *ngIf="meeting.notes" class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed text-clamp-2">
              <span class="material-symbols-outlined text-xs mr-1 align-middle">notes</span>
              {{ meeting.notes }}
            </div>

            <!-- Host Information -->
            <div class="text-sm text-slate-600 dark:text-slate-300 mb-3">
              <div class="flex items-center">
                <span class="material-symbols-outlined text-base mr-2 text-amber-500">person</span>
                <span class="font-medium">Host:</span>
                <span class="ml-1">{{ meeting.creatorName }}</span>
              </div>
            </div>

            <!-- Participants -->
            <div class="text-sm text-slate-600 dark:text-slate-300">
              <div class="flex items-center mb-2">
                <span class="material-symbols-outlined text-base mr-2 text-purple-500">people</span>
                <span>{{ getTotalParticipants(meeting) }} katılımcı</span>
              </div>
              <div class="ml-6 text-xs text-slate-500 dark:text-slate-400 space-y-1">
                <!-- Host -->
                <div class="flex items-center">
                  <div class="avatar avatar-sm bg-gradient-to-r from-orange-500 to-red-500 text-white mr-2">
                    {{ meeting.creatorName.charAt(0) }}
                  </div>
                  <span>{{ meeting.creatorName }} (Host)</span>
                </div>
                <!-- Invitees -->
                <div *ngFor="let invitee of (meeting.invitees || []).slice(0, 2)" class="flex items-center">
                  <div class="avatar avatar-sm bg-gradient-to-r from-purple-500 to-blue-500 text-white mr-2">
                    {{ invitee.name.charAt(0) }}
                  </div>
                  <span>{{ invitee.name }}</span>
                </div>
                <div *ngIf="(meeting.invitees || []).length > 2" class="text-slate-400 dark:text-slate-500 mt-1">
                  +{{ (meeting.invitees || []).length - 2 }} daha
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="p-6 mt-auto bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/10 dark:to-purple-900/10 border-t border-slate-200 dark:border-slate-600">
          <div class="flex items-center justify-between">
            <div class="flex space-x-3">
              <button 
                [routerLink]="getJoinRoute(meeting.id)"
                [disabled]="!canJoinMeeting(meeting.id)"
                [class.btn-primary]="canJoinMeeting(meeting.id)"
                [class.btn-secondary]="!canJoinMeeting(meeting.id)"
                [class.opacity-50]="!canJoinMeeting(meeting.id)"
                class="btn btn-sm"
                [title]="getCurrentMeetingStatus(meeting.id)"
              >
                <span class="material-symbols-outlined text-sm mr-1">video_call</span>
                <span *ngIf="isCurrentlyInThisMeeting(meeting.id)">
                  {{ meetingStatus.currentMeeting()?.isBackground ? 'Toplantıya Dön' : 'Toplantıda' }}
                </span>
                <span *ngIf="!isCurrentlyInThisMeeting(meeting.id)">Odaya Gir</span>
              </button>
              <button 
                *ngIf="isHost(meeting)"
                class="btn btn-secondary btn-sm"
                (click)="editMeeting(meeting)"
              >
                <span class="material-symbols-outlined text-sm mr-1">edit</span>
                Düzenle
              </button>
            </div>
            <button 
              *ngIf="isHost(meeting)"
              class="btn btn-danger btn-sm p-2"
              (click)="deleteMeeting(meeting)"
              title="Toplantıyı Sil"
            >
              <span class="material-symbols-outlined text-sm">delete</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && (!items || items.length === 0)" class="py-20 animate-fade-in">
      <div class="max-w-3xl mx-auto">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 p-8 md:p-10">
          <div class="flex flex-col md:flex-row items-center gap-8">
            <div class="w-24 h-24 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-white text-4xl">
                {{ selectedUserId ? 'search_off' : 'video_call' }}
              </span>
            </div>
            <div class="text-center md:text-left flex-1">
              <h3 class="text-2xl md:text-3xl font-bold text-slate-900 dark:text-white mb-2">
                {{ selectedUserId ? 'Filtreleme Sonucu Bulunamadı' : 'Aktif Toplantı Bulunamadı' }}
              </h3>
              <p class="text-slate-600 dark:text-slate-400 mb-6 text-base md:text-lg">
                {{ selectedUserId 
                  ? 'Seçilen kişiyle ilgili toplantı bulunamadı. Farklı bir kişi seçmeyi deneyin veya filtreyi temizleyin.' 
                  : 'Şu anda aktif toplantınız bulunmuyor. Yeni bir toplantı oluşturarak başlayabilirsiniz.' 
                }}
              </p>
              <div class="flex justify-center md:justify-start space-x-3">
                <button 
                  *ngIf="!selectedUserId"
                  routerLink="/meetings/new"
                  class="btn btn-primary btn-lg">
                  <span class="material-symbols-outlined mr-2">add</span>
                  Yeni Toplantı Oluştur
                </button>
                <button 
                  *ngIf="selectedUserId"
                  (click)="clearFilter()"
                  class="btn btn-secondary btn-lg">
                  <span class="material-symbols-outlined mr-2">clear_all</span>
                  Filtreyi Temizle
                </button>
                <button 
                  *ngIf="selectedUserId"
                  routerLink="/meetings/new"
                  class="btn btn-primary btn-lg">
                  <span class="material-symbols-outlined mr-2">add</span>
                  Yeni Toplantı Oluştur
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 max-w-2xl mx-auto p-6 animate-fade-in">
      <div class="flex items-start space-x-4">
        <div class="w-10 h-10 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center flex-shrink-0">
          <span class="material-symbols-outlined text-red-600 dark:text-red-400">error</span>
        </div>
        <div class="flex-1">
          <h3 class="text-lg font-semibold text-red-800 dark:text-red-200 mb-2">Bir Hata Oluştu</h3>
          <p class="text-red-700 dark:text-red-300">{{ error }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Meeting Modal -->
  <div *ngIf="showEditModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in">
    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-scale-in">
      <!-- Modal Header -->
      <div class="p-6 border-b border-slate-200 dark:border-slate-700">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold text-slate-900 dark:text-white flex items-center">
            <span class="material-symbols-outlined text-blue-500 mr-2">edit</span>
            Toplantıyı Düzenle
          </h2>
          <button 
            (click)="closeEditModal()"
            class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors"
          >
            <span class="material-symbols-outlined text-slate-500 dark:text-slate-400">close</span>
          </button>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="p-6 space-y-6">
        <!-- Error Message -->
        <div *ngIf="editError" class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
          <div class="flex items-center">
            <span class="material-symbols-outlined text-red-500 mr-2">error</span>
            <p class="text-red-700 dark:text-red-300 text-sm">{{ editError }}</p>
          </div>
        </div>

        <!-- Form -->
        <form (ngSubmit)="saveMeeting()" class="space-y-6">
          <!-- Title -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Toplantı Başlığı
            </label>
            <input 
              type="text" 
              [(ngModel)]="editForm.title"
              name="title"
              required
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              placeholder="Toplantı başlığını girin"
            >
          </div>

          <!-- Date and Time -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Başlangıç Zamanı
              </label>
              <input 
                type="datetime-local" 
                [(ngModel)]="editForm.startsAt"
                name="startsAt"
                required
                class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              >
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Bitiş Zamanı
              </label>
              <input 
                type="datetime-local" 
                [(ngModel)]="editForm.endsAt"
                name="endsAt"
                required
                class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
              >
            </div>
          </div>

          <!-- Notes -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Notlar
            </label>
            <textarea 
              [(ngModel)]="editForm.notes"
              name="notes"
              rows="3"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none"
              placeholder="Toplantı notları (opsiyonel)"
            ></textarea>
          </div>

          <!-- Status -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Durum
            </label>
            <select 
              [(ngModel)]="editForm.status"
              name="status"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
            >
              <option value="scheduled">Planlandı</option>
              <option value="canceled">İptal Edildi</option>
              <option value="done">Tamamlandı</option>
            </select>
          </div>

          <!-- Invitees -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3">
              Katılımcılar
            </label>
            <div class="space-y-2 max-h-40 overflow-y-auto border border-slate-200 dark:border-slate-600 rounded-xl p-4">
              <div *ngFor="let user of users" class="flex items-center space-x-3">
                <input 
                  type="checkbox" 
                  [id]="'invitee-' + user.id"
                  [checked]="isInviteeSelected(user.id)"
                  (change)="toggleInvitee(user.id)"
                  class="w-4 h-4 text-blue-600 bg-slate-100 border-slate-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-slate-800 focus:ring-2 dark:bg-slate-700 dark:border-slate-600"
                >
                <label [for]="'invitee-' + user.id" class="text-sm text-slate-700 dark:text-slate-300 cursor-pointer">
                  {{ user.name }}
                </label>
              </div>
            </div>
          </div>

          <!-- Modal Footer -->
          <div class="flex items-center justify-end space-x-3 pt-6 border-t border-slate-200 dark:border-slate-700">
            <button 
              type="button"
              (click)="closeEditModal()"
              class="btn btn-secondary"
              [disabled]="editLoading"
            >
              İptal
            </button>
            <button 
              type="submit"
              class="btn btn-primary"
              [disabled]="editLoading"
            >
              <span *ngIf="editLoading" class="material-symbols-outlined text-sm mr-2 animate-spin">refresh</span>
              <span *ngIf="!editLoading" class="material-symbols-outlined text-sm mr-2">save</span>
              {{ editLoading ? 'Kaydediliyor...' : 'Kaydet' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
