<div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center p-4 pt-20 relative overflow-hidden">
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-5">
    <div class="absolute top-0 left-0 w-72 h-72 bg-blue-500 rounded-full filter blur-3xl"></div>
    <div class="absolute bottom-0 right-0 w-96 h-96 bg-purple-500 rounded-full filter blur-3xl"></div>
  </div>
  
  <div class="w-full max-w-6xl relative z-10">
    <!-- Header -->
    <div class="text-center mb-12 animate-fade-in">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mb-6 shadow-lg">
        <span class="material-symbols-outlined text-2xl text-white">video_call</span>
      </div>
      <h1 class="text-4xl lg:text-5xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 dark:from-white dark:to-slate-300 bg-clip-text text-transparent mb-4">Toplantıya Katıl</h1>
      <p class="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">Mikrofon ve kameranızı test edin, ardından toplantıya katılın</p>
    </div>

    <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 lg:gap-12">
      <!-- Video Preview -->
      <div class="xl:col-span-2 space-y-8">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden">
          <div class="p-6 bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800 border-b border-slate-200 dark:border-slate-600">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                <span class="material-symbols-outlined text-white text-lg">videocam</span>
              </div>
              <div>
                <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Kamera Önizleme</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400">Gerçek zamanlı görüntü testi</p>
              </div>
            </div>
          </div>
          <div class="aspect-video bg-gradient-to-br from-slate-200 to-slate-300 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center relative overflow-hidden">
            <video #previewVideo 
                   autoplay 
                   playsinline 
                   muted 
                   class="w-full h-full object-cover transition-all duration-300"
                   [class.hidden]="!isCameraOn">
            </video>
            <div *ngIf="!isCameraOn" class="flex flex-col items-center justify-center text-slate-600 dark:text-white p-8">
              <div class="w-20 h-20 bg-slate-300 dark:bg-slate-700 rounded-full flex items-center justify-center mb-6">
                <span class="material-symbols-outlined text-4xl text-slate-500 dark:text-slate-300">videocam_off</span>
              </div>
              <p class="text-xl font-medium mb-2">Kamera Kapalı</p>
              <p class="text-sm text-slate-500 dark:text-slate-400 text-center">Kamerayı açmak için sağdaki ayarları kullanın</p>
            </div>
            <div *ngIf="cameraError" class="absolute inset-0 bg-red-900/90 backdrop-blur-sm flex items-center justify-center text-white">
              <div class="text-center p-8">
                <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mb-4 mx-auto">
                  <span class="material-symbols-outlined text-2xl">error</span>
                </div>
                <p class="text-lg font-medium mb-2">Kamera Erişimi Gerekli</p>
                <p class="text-sm opacity-75">Tarayıcı ayarlarından kamera erişimi izni verin</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Audio Level Indicator -->
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 p-6 hover:shadow-2xl transition-all duration-300">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                <span class="material-symbols-outlined text-white text-lg">mic</span>
              </div>
              <div>
                <h3 class="text-xl font-semibold text-slate-900 dark:text-white">Mikrofon Seviyesi</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400">Ses kalitesini test edin</p>
              </div>
            </div>
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 rounded-full flex items-center justify-center" [class.bg-green-100]="isMicOn" [class.bg-red-100]="!isMicOn">
                <span class="material-symbols-outlined text-green-600" *ngIf="isMicOn">mic</span>
                <span class="material-symbols-outlined text-red-600" *ngIf="!isMicOn">mic_off</span>
              </div>
            </div>
          </div>
          <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-3 overflow-hidden">
            <div class="bg-gradient-to-r from-green-400 via-yellow-400 to-red-500 h-3 rounded-full transition-all duration-150 shadow-sm"
                 [style.width.%]="audioLevel"></div>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400 mt-3">
            <span class="font-medium">{{ audioLevel > 0 ? 'Ses algılanıyor' : 'Mikrofonunuzu test etmek için konuşun' }}</span>
          </p>
        </div>
      </div>

      <!-- Controls Panel -->
      <div class="space-y-8">
        <!-- Device Controls -->
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 p-6 hover:shadow-2xl transition-all duration-300">
          <div class="flex items-center space-x-3 mb-6">
            <div class="w-11 h-11 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg flex items-center justify-center">
              <span class="material-symbols-outlined text-white text-lg">settings</span>
            </div>
            <div>
              <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Cihaz Ayarları</h2>
              <p class="text-sm text-slate-500 dark:text-slate-400">Cihazlarınızı yapılandırın</p>
            </div>
          </div>

          
          <!-- Camera Control -->
          <div class="py-4 border-b border-slate-200 dark:border-slate-700 mb-4">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-xl flex items-center justify-center">
                  <span class="material-symbols-outlined text-blue-600 dark:text-blue-400 text-xl">videocam</span>
                </div>
                <div>
                  <p class="font-semibold text-slate-900 dark:text-white">Kamera</p>
                  <p class="text-xs text-slate-500 dark:text-slate-400">{{ isCameraOn ? 'Açık' : 'Kapalı' }}</p>
                </div>
              </div>
              
              <!-- Camera Toggle Switch (when permission granted) -->
              <button *ngIf="permissionService.hasCameraPermission()"
                      class="relative inline-flex h-7 w-12 items-center rounded-full transition-all duration-300 transform hover:scale-105"
                      [class.bg-blue-600]="isCameraOn"
                      [class.bg-slate-300]="!isCameraOn"
                      (click)="toggleCamera()"
                      [disabled]="loading">
                <span class="inline-block h-5 w-5 transform rounded-full bg-white shadow-md transition-all duration-300"
                      [class.translate-x-6]="isCameraOn"
                      [class.translate-x-1]="!isCameraOn"></span>
              </button>
            </div>
            
            <!-- Camera Permission Warning (when no permission) -->
            <div *ngIf="!permissionService.hasCameraPermission()" class="mb-3">
              <div class="flex items-center p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md">
                <span class="material-symbols-outlined text-amber-600 dark:text-amber-400 text-sm mr-2">warning</span>
                <span class="text-sm text-amber-700 dark:text-amber-300">Kamera izni gerekli</span>
                <button 
                  class="ml-auto px-2 py-1 text-sm bg-amber-600 hover:bg-amber-700 text-white rounded transition-colors"
                  (click)="requestCameraPermission()"
                  [disabled]="loading">
                  İzin Ver
                </button>
              </div>
            </div>
          </div>

          <!-- Microphone Control -->
          <div class="py-4 border-b border-slate-200 dark:border-slate-700 mb-6">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-xl flex items-center justify-center">
                  <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-xl">mic</span>
                </div>
                <div>
                  <p class="font-semibold text-slate-900 dark:text-white">Mikrofon</p>
                  <p class="text-xs text-slate-500 dark:text-slate-400">{{ isMicOn ? 'Açık' : 'Kapalı' }}</p>
                </div>
              </div>
              
              <!-- Microphone Toggle Switch (when permission granted) -->
              <button *ngIf="permissionService.hasMicrophonePermission()"
                      class="relative inline-flex h-7 w-12 items-center rounded-full transition-all duration-300 transform hover:scale-105"
                      [class.bg-green-600]="isMicOn"
                      [class.bg-slate-300]="!isMicOn"
                      (click)="toggleMicrophone()"
                      [disabled]="loading">
                <span class="inline-block h-5 w-5 transform rounded-full bg-white shadow-md transition-all duration-300"
                      [class.translate-x-6]="isMicOn"
                      [class.translate-x-1]="!isMicOn"></span>
              </button>
            </div>
            
            <!-- Microphone Permission Warning (when no permission) -->
            <div *ngIf="!permissionService.hasMicrophonePermission()" class="mb-3">
              <div class="flex items-center p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md">
                <span class="material-symbols-outlined text-amber-600 dark:text-amber-400 text-sm mr-2">warning</span>
                <span class="text-sm text-amber-700 dark:text-amber-300">Mikrofon izni gerekli</span>
                <button 
                  class="ml-auto px-2 py-1 text-sm bg-amber-600 hover:bg-amber-700 text-white rounded transition-colors"
                  (click)="requestMicrophonePermission()"
                  [disabled]="loading">
                  İzin Ver
                </button>
              </div>
            </div>
          </div>

          <!-- Device Selection -->
          <div class="space-y-4">
            <!-- Camera Selection -->
            <div>
              <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Kamera</label>
              <select 
                *ngIf="permissionService.hasCameraPermission()"
                class="w-full px-3 py-2 text-sm bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                [(ngModel)]="selectedCamera"
                (change)="onCameraChange()"
                [disabled]="loading">
                <option value="">Varsayılan Kamera</option>
                <option *ngFor="let camera of availableCameras" [value]="camera.deviceId">
                  {{ getDeviceName(camera) }}
                </option>
              </select>
            </div>

            <!-- Microphone Selection -->
            <div>
              <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Mikrofon</label>
              <select 
                *ngIf="permissionService.hasMicrophonePermission()"
                class="w-full px-3 py-2 text-sm bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                [(ngModel)]="selectedMicrophone"
                (change)="onMicrophoneChange()"
                [disabled]="loading">
                <option value="">Varsayılan Mikrofon</option>
                <option *ngFor="let mic of availableMicrophones" [value]="mic.deviceId">
                  {{ getDeviceName(mic) }}
                </option>
              </select>
            </div>

            <!-- Mirror preview toggle -->
            <div>
              <label class="inline-flex items-center space-x-2">
                <input type="checkbox" class="h-4 w-4" (change)="onMirrorToggle($event)" [checked]="mirrorPreview()">
                <span class="text-sm text-slate-700 dark:text-slate-300">Önizlemeyi Aynala (Selfie)</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Join Meeting -->
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 p-6 hover:shadow-2xl transition-all duration-300">
          <div class="text-center mb-6">
            <div class="w-12 h-12 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="material-symbols-outlined text-white text-xl">group</span>
            </div>
            <h2 class="text-xl font-semibold text-slate-900 dark:text-white mb-2">Toplantıya Katıl</h2>
            <p class="text-sm text-slate-600 dark:text-slate-400">
              Cihazlarınızı test ettikten sonra toplantıya katılabilirsiniz.
            </p>
          </div>
          
          <div class="space-y-4">
            <button 
              class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 hover:shadow-lg flex items-center justify-center space-x-3 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
              (click)="joinMeeting()"
              [disabled]="!isDeviceReady || loading">
              
              <span class="material-symbols-outlined text-xl" *ngIf="!isDeviceReady && !loading">hourglass_empty</span>
              <span class="material-symbols-outlined text-xl" *ngIf="isDeviceReady && !loading">check_circle</span>
              <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" *ngIf="loading"></div>
              
              <span class="text-lg" *ngIf="!isDeviceReady && !loading">{{ deviceCheckMessage }}</span>
              <span class="text-lg" *ngIf="isDeviceReady && !loading">Toplantıya Katıl</span>
              <span class="text-lg" *ngIf="loading">{{ deviceCheckMessage }}</span>
            </button>

            <button 
              class="w-full bg-white dark:bg-slate-700 border-2 border-slate-300 dark:border-slate-600 hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 dark:text-slate-300 font-semibold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 hover:shadow-lg flex items-center justify-center space-x-3"
              (click)="goBack()">
              <span class="material-symbols-outlined text-xl">arrow_back</span>
              <span>Geri Dön</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>