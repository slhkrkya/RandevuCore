<div class="speaker-view-container">
  
  <!-- Main Speaker Video -->
  <div class="main-speaker-area bg-white/5 dark:bg-black/20 backdrop-blur-sm">
    <div class="main-video-container">
      <video *ngIf="getActiveSpeaker() && isParticipantVideoVisible(getActiveSpeaker()!)"
             #mainVideo
             [attr.data-user-id]="getActiveSpeaker()?.userId"
             autoplay
             playsinline
             [muted]="getActiveSpeaker()?.userId === currentUserId"
             class="main-video"
             (loadedmetadata)="onMainVideoLoaded($event)"
             (error)="onMainVideoError($event)">
      </video>
      
      <!-- Placeholder when no video -->
      <div *ngIf="!getActiveSpeaker() || !isParticipantVideoVisible(getActiveSpeaker()!)"
           class="main-video-placeholder"
           [class]="getActiveSpeaker() ? getParticipantBackgroundColor(getActiveSpeaker()!) : 'bg-gradient-to-br from-slate-300 to-slate-400 dark:from-slate-700 dark:to-slate-800'">
        <!-- âœ¨ NEW: Loading spinner when video is pending -->
        <div *ngIf="getActiveSpeaker() && isVideoLoading(getActiveSpeaker()!)" 
             class="absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-sm z-10">
          <div class="flex flex-col items-center space-y-3">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white"></div>
            <div class="text-sm text-white font-medium">Video yÃ¼kleniyor...</div>
          </div>
        </div>
        <div class="placeholder-content">
          <div class="participant-initials">
            {{ getActiveSpeaker() ? getParticipantInitials(getActiveSpeaker()!) : '?' }}
          </div>
          <div class="participant-name">
            {{ getActiveSpeaker() ? getParticipantDisplayName(getActiveSpeaker()!) : 'KonuÅŸmacÄ± Yok' }}
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Speaker Name with Pin Button -->
    <div class="main-speaker-name" *ngIf="getActiveSpeaker() as main">
      {{ getParticipantDisplayName(main) }}
      <span *ngIf="main.isHost" class="host-indicator">ðŸ‘‘</span>
      <button class="inline-pin-btn"
              (click)="togglePin(main)"
              [attr.aria-pressed]="isPinned(main)"
              [title]="isPinned(main) ? 'Bu kiÅŸiyi ana ekrandan kaldÄ±r' : 'Bu kiÅŸiyi ana ekranda sabitle'">
        <span class="material-symbols-outlined pin-icon" [class.pinned]="isPinned(main)">
          {{ isPinned(main) ? 'push_pin' : 'push_pin' }}
        </span>
      </button>
    </div>
    
    <!-- Other Participants Thumbnails -->
    <div class="participants-thumbnails" *ngIf="getOtherParticipants().length > 0">
    <div *ngFor="let participant of getOtherParticipants(); trackBy: trackByUserId" 
         class="participant-thumbnail">
      
      <!-- Participant Name -->
      <div class="thumbnail-name">
        {{ getParticipantDisplayName(participant) }}
      </div>
      
      <!-- Video Stream -->
      <video *ngIf="isParticipantVideoVisible(participant)"
             #thumbnailVideo
             [attr.data-user-id]="participant.userId"
             autoplay
             playsinline
             [muted]="participant.userId === currentUserId"
             class="thumbnail-video"
             (loadedmetadata)="onThumbnailVideoLoaded($event, participant)"
             (error)="onThumbnailVideoError($event, participant)">
      </video>
      
      <!-- Placeholder when no video -->
      <div *ngIf="!isParticipantVideoVisible(participant)"
           class="thumbnail-placeholder"
           [class]="getParticipantBackgroundColor(participant)">
        <!-- âœ¨ NEW: Loading spinner when video is pending -->
        <div *ngIf="isVideoLoading(participant)" 
             class="absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-sm z-10">
          <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-white"></div>
        </div>
        <div class="thumbnail-initials">
          {{ getParticipantInitials(participant) }}
        </div>
      </div>

      <!-- Pin toggle on thumbnail - Top Left Corner -->
      <button class="thumbnail-pin-btn"
              (click)="togglePin(participant)"
              [attr.aria-pressed]="isPinned(participant)"
              [title]="isPinned(participant) ? 'Bu kiÅŸiyi ana ekrandan kaldÄ±r' : 'Bu kiÅŸiyi ana ekranda sabitle'">
        <span class="material-symbols-outlined pin-icon" [class.pinned]="isPinned(participant)">
          {{ isPinned(participant) ? 'push_pin' : 'push_pin' }}
        </span>
      </button>
      
    </div>
    
  </div>
  
  <!-- Empty State -->
  <div *ngIf="participants.length === 0" class="empty-state">
    <div class="empty-content">
      <span class="material-symbols-outlined">people</span>
      <h3>No participants</h3>
      <p>Waiting for others to join...</p>
    </div>
  </div>
  
</div>
