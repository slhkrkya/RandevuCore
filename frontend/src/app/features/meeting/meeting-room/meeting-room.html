<div class="meeting-room-container flex min-h-screen w-full bg-gradient-to-br from-slate-100 via-slate-200 to-slate-100 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 text-slate-900 dark:text-white overflow-visible pt-20">
  
  <!-- Loading Overlay (during initialization and auto-refresh) -->
  <div *ngIf="isInitializing$ | async" 
       class="fixed inset-0 z-[9999] flex items-center justify-center bg-slate-900/95 backdrop-blur-md">
    <div class="flex flex-col items-center space-y-6 p-8 rounded-2xl bg-white/5 backdrop-blur-sm border border-white/10">
      <!-- Animated Logo/Icon -->
      <div class="relative">
        <div class="absolute inset-0 animate-ping opacity-20">
          <div class="w-20 h-20 rounded-full bg-primary-500"></div>
        </div>
        <div class="relative w-20 h-20 rounded-full bg-gradient-to-br from-primary-500 to-primary-600 flex items-center justify-center shadow-lg shadow-primary-500/50">
          <span class="material-symbols-outlined text-4xl text-white">videocam</span>
        </div>
      </div>
      
      
      <!-- Loading Message -->
      <div class="text-center space-y-2">
        <h3 class="text-xl font-semibold text-white">{{ initializingMessage$ | async }}</h3>
        <p class="text-sm text-slate-300">Lütfen bekleyin...</p>
      </div>
      
      <!-- Progress Dots -->
      <div class="flex space-x-2">
        <div class="w-2 h-2 rounded-full bg-primary-400 animate-bounce" style="animation-delay: 0ms;"></div>
        <div class="w-2 h-2 rounded-full bg-primary-400 animate-bounce" style="animation-delay: 150ms;"></div>
        <div class="w-2 h-2 rounded-full bg-primary-400 animate-bounce" style="animation-delay: 300ms;"></div>
      </div>
    </div>
  </div>
  
  <!-- Main Content Area -->
  <div class="meeting-main-area flex-1 flex flex-col relative transition-all duration-300"
       [class.mr-80]="(showParticipantsPanel$ | async) || (showChatPanel$ | async)">
    
    <!-- Meeting Content -->
    <div class="flex-1 relative pb-32 min-h-screen">
      
      <!-- Video Grid View -->
      <div *ngIf="(activeView$ | async) === 'grid'" class="h-screen w-full">
        <app-video-grid 
          [currentUserId]="currentUserId"
          [localStream]="localStream$ | async"
          [remoteStreams]="remoteStreams$ | async"
          [meetingState]="meetingState$ | async">
        </app-video-grid>
      </div>

      <!-- Speaker View -->
      <div *ngIf="(activeView$ | async) === 'speaker'" class="h-screen w-full">
        <app-speaker-view 
          [currentUserId]="currentUserId"
          [localStream]="localStream$ | async"
          [remoteStreams]="remoteStreams$ | async"
          [meetingState]="meetingState$ | async">
        </app-speaker-view>
      </div>

      <!-- Whiteboard View -->
      <div *ngIf="(activeView$ | async) === 'whiteboard'" class="w-full">
        <app-whiteboard 
          [isActive]="(meetingState$ | async)?.isWhiteboardActive || false"
          [isHost]="isHost"
          [roomKey]="roomKey"
          [currentUserId]="currentUserId"
          [localStream]="localStream$ | async"
          [remoteStreams]="remoteStreams$ | async"
          [meetingState]="meetingState$ | async">
        </app-whiteboard>
      </div>

    </div>

    <!-- Meeting Controls -->
    <app-meeting-controls
      [meetingState]="meetingState$ | async"
      [isHost]="isHost"
      [participantsCount]="(participants$ | async)?.length || 0"
      [showParticipantsPanel]="showParticipantsPanel$ | async"
      [showChatPanel]="showChatPanel$ | async"
      [showWhiteboardPanel]="showWhiteboardPanel$ | async"
      [activeView]="activeView$ | async"
      [isMuteToggling]="isMuteToggling$ | async"
      [isVideoToggling]="isVideoToggling$ | async"
      [isScreenShareToggling]="isScreenShareToggling$ | async"
      [meetingDuration]="meetingDuration$ | async"
      (toggleMute)="toggleMute()"
      (toggleVideo)="toggleVideo()"
      (toggleScreenShare)="toggleScreenShare()"
      (toggleParticipantsPanel)="toggleParticipantsPanel()"
      (toggleChatPanel)="toggleChatPanel()"
      (toggleWhiteboardPanel)="toggleWhiteboardPanel()"
      (setActiveView)="setActiveView($event)"
      (toggleFullscreen)="toggleFullscreen()"
      (endMeeting)="endMeeting()">
    </app-meeting-controls>

  </div>

  <!-- Participants Panel -->
  <div class="fixed top-0 right-0 h-full w-80 bg-white/95 dark:bg-slate-800/95 backdrop-blur-md shadow-2xl transform transition-transform duration-300 z-50 border-l border-slate-300 dark:border-slate-700"
       [class.translate-x-full]="!(showParticipantsPanel$ | async)"
       [class.translate-x-0]="showParticipantsPanel$ | async">
    <app-participants-panel
      [currentUserId]="currentUserId"
      [isHost]="isHost"
      (grantPermission)="grantPermission($event.userId, $event.permission)"
      (removeParticipant)="removeParticipant($event)"
      (close)="toggleParticipantsPanel()">
    </app-participants-panel>
  </div>

  <!-- Chat Panel -->
  <div class="fixed top-0 right-0 h-full w-full sm:w-80 lg:w-96 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md shadow-2xl transform transition-transform duration-300 z-50 border-l border-slate-300/50 dark:border-slate-700/50"
       [class.translate-x-full]="!(showChatPanel$ | async)"
       [class.translate-x-0]="showChatPanel$ | async">
    <app-chat-panel
      [roomKey]="roomKey"
      [currentUserId]="currentUserId"
      [currentUserName]="currentUserName"
      [isHost]="isHost"
      (close)="toggleChatPanel()">
    </app-chat-panel>
  </div>

  <!-- Meeting Info - Centered Horizontal Layout -->
  <div class="meeting-info-floating absolute top-20 left-1/2 transform -translate-x-1/2 z-30">
    <div class="flex items-center justify-center space-x-6 text-sm text-slate-700 dark:text-slate-200 font-medium">
      
      <!-- Connection Status -->
      <div class="flex items-center space-x-1.5">
        <div class="w-2 h-2 rounded-full" 
             [class.bg-emerald-500]="connected"
             [class.bg-red-500]="!connected">
        </div>
        <span class="material-symbols-outlined text-base" 
              [class.text-emerald-600]="connected"
              [class.text-red-600]="!connected"
              [class.dark:text-emerald-400]="connected"
              [class.dark:text-red-400]="!connected">wifi</span>
        {{ connected ? 'Bağlı' : 'Bağlanıyor...' }}
      </div>
      
      <!-- Meeting Duration -->
      <div class="flex items-center space-x-1.5">
        <span class="material-symbols-outlined text-base text-blue-600 dark:text-blue-400">schedule</span>
        {{ meetingDuration$ | async }}
      </div>
      
      <!-- Participants Count -->
      <div class="flex items-center space-x-1.5">
        <span class="material-symbols-outlined text-base text-purple-600 dark:text-purple-400">people</span>
        <span>{{ (participants$ | async)?.length || 0 }}</span>
        <span>katılımcı</span>
      </div>
      
      <!-- Host Indicator -->
      <div *ngIf="isHost" class="flex items-center space-x-1.5 text-amber-600 dark:text-amber-400 font-semibold">
        <span class="material-symbols-outlined text-base">star</span>
        Host
      </div>
      
    </div>
  </div>


</div>